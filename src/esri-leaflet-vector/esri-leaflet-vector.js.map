{"version":3,"file":"esri-leaflet-vector.js","sources":["../node_modules/mapbox-gl-leaflet/leaflet-mapbox-gl.js","../src/Util.js","../src/Basemap.js","../src/Layer.js"],"sourcesContent":["(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(['leaflet', 'mapbox-gl'], factory);\n    } else if (typeof exports === 'object') {\n        // Node, CommonJS-like\n        module.exports = factory(require('leaflet'), require('mapbox-gl'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(window.L, window.mapboxgl);\n    }\n}(this, function (L, mapboxgl) {\n    L.MapboxGL = L.Layer.extend({\n            options: {\n            updateInterval: 32,\n            // How much to extend the overlay view (relative to map size)\n            // e.g. 0.1 would be 10% of map view in each direction\n            padding: 0.1,\n            // whether or not to register the mouse and keyboard\n            // events on the mapbox overlay\n            interactive: false,\n            // set the tilepane as the default pane to draw gl tiles\n            pane: 'tilePane'\n        },\n\n        initialize: function (options) {\n            L.setOptions(this, options);\n\n            if (options.accessToken) {\n                mapboxgl.accessToken = options.accessToken;\n            }\n\n            // setup throttling the update event when panning\n            this._throttledUpdate = L.Util.throttle(this._update, this.options.updateInterval, this);\n        },\n\n        onAdd: function (map) {\n            if (!this._container) {\n                this._initContainer();\n            }\n\n            var paneName = this.getPaneName();\n            map.getPane(paneName).appendChild(this._container);\n            \n            this._initGL();\n\n            this._offset = this._map.containerPointToLayerPoint([0, 0]);\n\n            // work around https://github.com/mapbox/mapbox-gl-leaflet/issues/47\n            if (map.options.zoomAnimation) {\n                L.DomEvent.on(map._proxy, L.DomUtil.TRANSITION_END, this._transitionEnd, this);\n            }\n        },\n\n        onRemove: function (map) {\n            if (this._map._proxy && this._map.options.zoomAnimation) {\n                L.DomEvent.off(this._map._proxy, L.DomUtil.TRANSITION_END, this._transitionEnd, this);\n            }\n            var paneName = this.getPaneName();\n            map.getPane(paneName).removeChild(this._container);\n            \n            this._glMap.remove();\n            this._glMap = null;\n        },\n\n        getEvents: function () {\n            return {\n                move: this._throttledUpdate, // sensibly throttle updating while panning\n                zoomanim: this._animateZoom, // applys the zoom animation to the <canvas>\n                zoom: this._pinchZoom, // animate every zoom event for smoother pinch-zooming\n                zoomstart: this._zoomStart, // flag starting a zoom to disable panning\n                zoomend: this._zoomEnd,\n                resize: this._resize\n            };\n        },\n\n        getMapboxMap: function () {\n            return this._glMap;\n        },\n\n        getCanvas: function () {\n            return this._glMap.getCanvas();\n        },\n\n        getSize: function () {\n            return this._map.getSize().multiplyBy(1 + this.options.padding * 2);\n        },\n\n        getBounds: function () {\n            var halfSize = this.getSize().multiplyBy(0.5);\n            var center = this._map.latLngToContainerPoint(this._map.getCenter());\n            return L.latLngBounds(\n                this._map.containerPointToLatLng(center.subtract(halfSize)),\n                this._map.containerPointToLatLng(center.add(halfSize))\n            );\n        },\n\n        getContainer: function () {\n            return this._container;\n        },\n        \n        // returns the pane name set in options if it is a valid pane, defaults to tilePane\n        getPaneName: function () {\n            return this._map.getPane(this.options.pane) ? this.options.pane : 'tilePane'; \n        },\n        \n        _initContainer: function () {\n            var container = this._container = L.DomUtil.create('div', 'leaflet-gl-layer');\n\n            var size = this.getSize();\n            var offset = this._map.getSize().multiplyBy(this.options.padding);\n            container.style.width  = size.x + 'px';\n            container.style.height = size.y + 'px';\n\n            var topLeft = this._map.containerPointToLayerPoint([0, 0]).subtract(offset);\n\n            L.DomUtil.setPosition(container, topLeft);\n        },\n\n        _initGL: function () {\n            var center = this._map.getCenter();\n\n            var options = L.extend({}, this.options, {\n                container: this._container,\n                center: [center.lng, center.lat],\n                zoom: this._map.getZoom() - 1,\n                attributionControl: false\n            });\n\n            this._glMap = new mapboxgl.Map(options);\n\n            // allow GL base map to pan beyond min/max latitudes\n            this._glMap.transform.latRange = null;\n            this._transformGL(this._glMap);\n\n            if (this._glMap._canvas.canvas) {\n                // older versions of mapbox-gl surfaced the canvas differently\n                this._glMap._actualCanvas = this._glMap._canvas.canvas;\n            } else {\n                this._glMap._actualCanvas = this._glMap._canvas;\n            }\n\n            // treat child <canvas> element like L.ImageOverlay\n            var canvas = this._glMap._actualCanvas;\n            L.DomUtil.addClass(canvas, 'leaflet-image-layer');\n            L.DomUtil.addClass(canvas, 'leaflet-zoom-animated');\n            if (this.options.interactive) {\n                L.DomUtil.addClass(canvas, 'leaflet-interactive');\n            }\n            if (this.options.className) {\n                L.DomUtil.addClass(canvas, this.options.className);\n            }\n        },\n\n        _update: function (e) {\n            // update the offset so we can correct for it later when we zoom\n            this._offset = this._map.containerPointToLayerPoint([0, 0]);\n\n            if (this._zooming) {\n                return;\n            }\n\n            var size = this.getSize(),\n                container = this._container,\n                gl = this._glMap,\n                offset = this._map.getSize().multiplyBy(this.options.padding),\n                topLeft = this._map.containerPointToLayerPoint([0, 0]).subtract(offset);\n\n            L.DomUtil.setPosition(container, topLeft);\n\n            this._transformGL(gl);\n\n            if (gl.transform.width !== size.x || gl.transform.height !== size.y) {\n                container.style.width  = size.x + 'px';\n                container.style.height = size.y + 'px';\n                if (gl._resize !== null && gl._resize !== undefined){\n                    gl._resize();\n                } else {\n                    gl.resize();\n                }\n            } else {\n                // older versions of mapbox-gl surfaced update publicly\n                if (gl._update !== null && gl._update !== undefined){\n                    gl._update();\n                } else {\n                    gl.update();\n                }\n            }\n        },\n\n        _transformGL: function (gl) {\n            var center = this._map.getCenter();\n\n            // gl.setView([center.lat, center.lng], this._map.getZoom() - 1, 0);\n            // calling setView directly causes sync issues because it uses requestAnimFrame\n\n            var tr = gl.transform;\n            tr.center = mapboxgl.LngLat.convert([center.lng, center.lat]);\n            tr.zoom = this._map.getZoom() - 1;\n        },\n\n        // update the map constantly during a pinch zoom\n        _pinchZoom: function (e) {\n            this._glMap.jumpTo({\n                zoom: this._map.getZoom() - 1,\n                center: this._map.getCenter()\n            });\n        },\n\n        // borrowed from L.ImageOverlay\n        // https://github.com/Leaflet/Leaflet/blob/master/src/layer/ImageOverlay.js#L139-L144\n        _animateZoom: function (e) {\n            var scale = this._map.getZoomScale(e.zoom);\n            var padding = this._map.getSize().multiplyBy(this.options.padding * scale);\n            var viewHalf = this.getSize()._divideBy(2);\n            // corrections for padding (scaled), adapted from\n            // https://github.com/Leaflet/Leaflet/blob/master/src/map/Map.js#L1490-L1508\n            var topLeft = this._map.project(e.center, e.zoom)\n                ._subtract(viewHalf)\n                ._add(this._map._getMapPanePos()\n                .add(padding))._round();\n            var offset = this._map.project(this._map.getBounds().getNorthWest(), e.zoom)\n                ._subtract(topLeft);\n\n            L.DomUtil.setTransform(\n                this._glMap._actualCanvas,\n                offset.subtract(this._offset),\n                scale\n            );\n        },\n\n        _zoomStart: function (e) {\n            this._zooming = true;\n        },\n\n        _zoomEnd: function () {\n            var scale = this._map.getZoomScale(this._map.getZoom());\n\n            L.DomUtil.setTransform(\n                this._glMap._actualCanvas,\n                // https://github.com/mapbox/mapbox-gl-leaflet/pull/130\n                null,\n                scale\n            );\n\n            this._zooming = false;\n\n            this._update();\n        },\n\n        _transitionEnd: function (e) {\n            L.Util.requestAnimFrame(function () {\n                var zoom = this._map.getZoom();\n                var center = this._map.getCenter();\n                var offset = this._map.latLngToContainerPoint(\n                    this._map.getBounds().getNorthWest()\n                );\n\n                // reset the scale and offset\n                L.DomUtil.setTransform(this._glMap._actualCanvas, offset, 1);\n\n                // enable panning once the gl map is ready again\n                this._glMap.once('moveend', L.Util.bind(function () {\n                    this._zoomEnd();\n                }, this));\n\n                // update the map position\n                this._glMap.jumpTo({\n                    center: center,\n                    zoom: zoom - 1\n                });\n            }, this);\n        },\n\n        _resize: function (e) {\n            this._transitionEnd(e);\n        }\n    });\n\n    L.mapboxGL = function (options) {\n        return new L.MapboxGL(options);\n    };\n\n}));\n\n","import L from 'leaflet';\nimport 'mapbox-gl';\nimport 'mapbox-gl-leaflet';\nimport { request } from 'esri-leaflet';\n\nexport function fetchMetadata (url, context) {\n  request(url, {}, function (error, style) {\n    if (!error) {\n      request(style.sources.esri.url, {}, function (error, tileMetadata) {\n        if (!error) {\n          formatStyle(style, tileMetadata, url);\n          context._mapboxGL = L.mapboxGL({\n            accessToken: 'ezree',\n            style: style\n          });\n\n          context._ready = true;\n          context.fire('ready', {}, true);\n        }\n      }, context);\n    } else {\n      throw new Error('Unable to fetch vector tile style metadata');\n    }\n  }, context);\n}\n\nexport function formatStyle (style, metadata, styleUrl) {\n  // if a relative path is referenced, the default style can be found in a standard location\n  if (style.sources.esri.url && style.sources.esri.url.indexOf('http') === -1) {\n    style.sources.esri.url = styleUrl.replace('/resources/styles/root.json', '');\n  }\n\n  // right now ArcGIS Pro published vector services have a slightly different signature\n  if (metadata.tiles && metadata.tiles[0].charAt(0) !== '/') {\n    metadata.tiles[0] = '/' + metadata.tiles[0];\n  }\n\n  if (metadata.tileMap && metadata.tileMap.charAt(0) !== '/') {\n    metadata.tileMap = '/' + metadata.tileMap;\n  }\n\n  style.sources.esri = {\n    type: 'vector',\n    scheme: 'xyz',\n    tilejson: metadata.tilejson || '2.0.0',\n    format: (metadata.tileInfo && metadata.tileInfo.format) || 'pbf',\n    index: metadata.tileMap ? style.sources.esri.url + metadata.tileMap : null,\n    tiles: [\n      style.sources.esri.url + metadata.tiles[0]\n    ],\n    description: metadata.description,\n    name: metadata.name,\n    /* mapbox-gl-js does not respect the indexing of esri tiles\n    because we cache to different zoom levels depending on feature density. articifially capping at 15, but 404s will still be encountered when zooming in tight in rural areas.\n\n    the *real* solution would be to make intermittent calls to our tilemap and update the maxzoom of the layer internally.\n\n    reference implementation: https://github.com/openstreetmap/iD/pull/5029\n    */\n    maxzoom: 15\n  };\n\n  if (style.glyphs.indexOf('http') === -1) {\n    // set paths to sprite and glyphs\n    style.glyphs = styleUrl.replace('styles/root.json', style.glyphs.replace('../', ''));\n    style.sprite = styleUrl.replace('styles/root.json', style.sprite.replace('../', ''));\n  }\n}\n\nexport var Util = {\n  fetchMetadata: fetchMetadata,\n  formatStyle: formatStyle\n};\n\nexport default Util;\n","import L from 'leaflet';\nimport { Util } from 'esri-leaflet';\nimport { fetchMetadata } from './Util';\n\nexport var Basemap = L.Layer.extend({\n  statics: {\n    URLPREFIX: 'https://www.arcgis.com/sharing/rest/content/items/',\n    URLSUFFIX: '/resources/styles/root.json',\n    STYLES: {\n      'OpenStreetMap': '3e1a00aeae81496587988075fe529f71',\n      // v2\n      'Streets': 'de26a3cf4cc9451298ea173c4b324736',\n      'StreetsRelief': 'b266e6d17fc345b498345613930fbd76',\n      // 7dc6cea0b1764a1f9af2e679f642f0f5 doesnt pass validation\n      'Topographic': '7a6bf0e8cb5a418085e66c0485e74d19',\n      // 86f556a2d1fd468181855a35e344567f doesnt pass validation\n      'StreetsNight': '93554006894c45a88136127535878fca',\n      'Newspaper': 'dfb04de5f3144a80bc3f9f336228d24a',\n      'Navigation': '63c47b7177f946b49902c24129b87252',\n      'Nova': '75f4dfdff19e445395653121a95a85db',\n      'ColoredPencil': '4cf7e1fb9f254dcda9c8fbadb15cf0f8',\n      'Hybrid': '30d6b8271e1849cd9c3042060001f425',\n      'Gray': '291da5eab3a0412593b66d384379f89f', // no labels\n      'DarkGray': '5e9b3685f4c24d8781073dd928ebda50', // no labels\n      'HumanGeography': '2afe5b807fa74006be6363fd243ffb30', // no labels\n      'HumanGeographyDetail': '97fa1365da1e43eabb90d0364326bc2d', // no labels\n      'DarkHumanGeography': 'd7397603e9274052808839b70812be50', // no labels\n      'DarkHumanGeographyDetail': '1ddbb25aa29c4811aaadd94de469856a', // no labels\n      'ChartedTerritory': '1c365daf37a744fbad748b67aa69dac8',\n      'MidCentury': '7675d44bb1e4428aa2c30a9b68f97822'\n      // 'ModernAntique': 'effe3475f05a4d608e66fd6eeb2113c0' // throws mismatched image size error\n    }\n  },\n\n  initialize: function (options) {\n    // L.Layer expects a JSON object literal to be passed in constructor\n    options = {\n      key: options\n    };\n\n    this._basemap = options.key;\n\n    if (typeof options.key === 'string' && Basemap.STYLES[options.key]) {\n      var url = Basemap.URLPREFIX + Basemap.STYLES[options.key] + Basemap.URLSUFFIX;\n      fetchMetadata(url, this);\n    } else {\n      throw new Error('L.esri.Vector.Basemap: Invalid parameter. Use one of \"DarkGray\", \"Gray\", \"Hybrid\", \"Navigation\", \"Streets\", \"StreetsNight\", \"StreetsRelief\", \"Topographic\"');\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    Util.setEsriAttribution(map);\n\n    if (map.attributionControl) {\n      if (this._basemap === 'OpenStreetMap') {\n        map.attributionControl.setPrefix('<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>');\n        map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, map layer by Esri</span>');\n      } else {\n        Util._getAttributionData('https://static.arcgis.com/attribution/World_Street_Map', map);\n        map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">USGS, NOAA</span>');\n      }\n    }\n\n    if (this._ready) {\n      this._asyncAdd();\n    } else {\n      this.once('ready', function () {\n        this._asyncAdd();\n      }, this);\n    }\n  },\n\n  onRemove: function (map) {\n    map.off('moveend', Util._updateMapAttribution);\n    map.removeLayer(this._mapboxGL);\n\n    if (map.attributionControl) {\n      var vectorAttribution = document.getElementsByClassName('esri-dynamic-attribution')[0].outerHTML;\n      // this doesn't work, not sure why.\n      map.attributionControl.removeAttribution(vectorAttribution);\n    }\n  },\n\n  _asyncAdd: function () {\n    var map = this._map;\n    // thought it was just me, but apparently its not easy to mixin two different styles\n    // https://github.com/mapbox/mapbox-gl-js/issues/4000\n\n    // set the background color of the map to the background color of the tiles\n    map.getContainer().style.background = this._mapboxGL.options.style.layers[0].paint['background-color'] || '#e1e3d0';\n\n    map.on('moveend', Util._updateMapAttribution);\n    this._mapboxGL.addTo(map, this);\n    // map._gl = this._mapboxGL;\n  }\n});\n\nexport function basemap (key) {\n  return new Basemap(key);\n}\n\nexport default Basemap;\n","import L from 'leaflet';\nimport { request, Util } from 'esri-leaflet';\nimport { fetchMetadata, formatStyle } from './Util';\n\nexport var Layer = L.Layer.extend({\n  statics: {\n    URLPREFIX: 'https://www.arcgis.com/sharing/rest/content/items/'\n  },\n\n  initialize: function (options) {\n    // L.Layer expects a JSON object literal to be passed in constructor\n    options = {\n      id: options\n    };\n\n    if (typeof options.id === 'string') {\n      var itemMetadataUrl = Layer.URLPREFIX + options.id;\n      var tileUrl;\n      var styleUrl;\n\n      request(itemMetadataUrl, {}, function (error, metadata) {\n        if (!error) {\n          tileUrl = metadata.url;\n\n          // custom tileset published using ArcGIS Pro\n          if (tileUrl.indexOf('basemaps.arcgis.com') === -1) {\n            this._customTileset = true;\n            // if copyright info was published, display it.\n            if (metadata.accessInformation) {\n              this._copyrightText = metadata.accessInformation;\n            }\n            request(tileUrl, {}, function (error, tileMetadata) {\n              if (!error) {\n                // right now ArcGIS Pro published vector services have a slightly different signature\n                if (tileMetadata.defaultStyles.charAt(0) !== '/') {\n                  tileMetadata.defaultStyles = '/' + tileMetadata.defaultStyles;\n                }\n\n                styleUrl = tileUrl + tileMetadata.defaultStyles + '/root.json';\n                request(styleUrl, {}, function (error, style) {\n                  if (!error) {\n                    formatStyle(style, tileMetadata, styleUrl);\n\n                    this._mapboxGL = L.mapboxGL({\n                      accessToken: 'ezree',\n                      style: style\n                    });\n\n                    this._ready = true;\n                    this.fire('ready', {}, true);\n                  }\n                }, this);\n              }\n            }, this);\n          } else {\n            // custom symbology applied to hosted basemap tiles\n            fetchMetadata(itemMetadataUrl + '/resources/styles/root.json', this);\n          }\n        }\n      }, this);\n    } else {\n      throw new Error('L.esri.Vector.Layer: Invalid parameter. Use the id of an ArcGIS Online vector tile item');\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    Util.setEsriAttribution(map);\n\n    if (this._ready) {\n      this._asyncAdd();\n    } else {\n      this.once('ready', function () {\n        this._asyncAdd();\n      }, this);\n    }\n  },\n\n  onRemove: function (map) {\n    map.off('moveend', Util._updateMapAttribution);\n    map.removeLayer(this._mapboxGL);\n\n    if (map.attributionControl) {\n      var vectorAttribution = document.getElementsByClassName('esri-dynamic-attribution')[0].outerHTML;\n      // this doesn't work, not sure why.\n      map.attributionControl.removeAttribution(vectorAttribution);\n    }\n  },\n\n  _asyncAdd: function () {\n    var map = this._map;\n    if (map.attributionControl) {\n      if (this._customTileset) {\n        if (this._copyrightText) {\n          // pull static copyright text for services published with Pro\n          map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">' + this._copyrightText + '</span>');\n        }\n      } else {\n        // provide dynamic attribution for Esri basemaps\n        Util._getAttributionData('https://static.arcgis.com/attribution/World_Street_Map', map);\n        map.attributionControl.addAttribution('<span class=\"esri-dynamic-attribution\">USGS, NOAA</span>');\n        map.on('moveend', Util._updateMapAttribution);\n      }\n    }\n\n    // set the background color of the map to the background color of the tiles\n    map.getContainer().style.background = this._mapboxGL.options.style.layers[0].paint['background-color'];\n    this._mapboxGL.addTo(map, this);\n  }\n});\n\nexport function layer (id) {\n  return new Layer(id);\n}\n\nexport default Layer;\n"],"names":["root","factory","fetchMetadata","url","context","request","error","style","Error","sources","esri","tileMetadata","formatStyle","_mapboxGL","L","mapboxGL","accessToken","_ready","fire","metadata","styleUrl","indexOf","replace","tiles","charAt","tileMap","type","scheme","tilejson","format","tileInfo","index","description","name","maxzoom","glyphs","sprite","this","mapboxgl","MapboxGL","Layer","extend","options","updateInterval","padding","interactive","pane","initialize","setOptions","_throttledUpdate","Util","throttle","_update","onAdd","map","_container","_initContainer","paneName","getPaneName","getPane","appendChild","_initGL","_offset","_map","containerPointToLayerPoint","zoomAnimation","DomEvent","on","_proxy","DomUtil","TRANSITION_END","_transitionEnd","onRemove","off","removeChild","_glMap","remove","getEvents","move","zoomanim","_animateZoom","zoom","_pinchZoom","zoomstart","_zoomStart","zoomend","_zoomEnd","resize","_resize","getMapboxMap","getCanvas","getSize","multiplyBy","getBounds","halfSize","center","latLngToContainerPoint","getCenter","latLngBounds","containerPointToLatLng","subtract","add","getContainer","container","create","size","offset","width","x","height","y","topLeft","setPosition","lng","lat","getZoom","attributionControl","Map","transform","latRange","_transformGL","_canvas","canvas","_actualCanvas","addClass","className","e","_zooming","gl","undefined","update","tr","LngLat","convert","jumpTo","scale","getZoomScale","viewHalf","_divideBy","project","_subtract","_add","_getMapPanePos","_round","getNorthWest","setTransform","requestAnimFrame","once","bind","define","amd","exports","module","require","returnExports","window","Basemap","statics","URLPREFIX","URLSUFFIX","STYLES","OpenStreetMap","Streets","StreetsRelief","Topographic","StreetsNight","Newspaper","Navigation","Nova","ColoredPencil","Hybrid","Gray","DarkGray","HumanGeography","HumanGeographyDetail","DarkHumanGeography","DarkHumanGeographyDetail","ChartedTerritory","MidCentury","key","_basemap","setEsriAttribution","setPrefix","addAttribution","_getAttributionData","_asyncAdd","_updateMapAttribution","removeLayer","vectorAttribution","document","getElementsByClassName","outerHTML","removeAttribution","background","layers","paint","addTo","id","tileUrl","itemMetadataUrl","_customTileset","accessInformation","_copyrightText","defaultStyles"],"mappings":"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"}