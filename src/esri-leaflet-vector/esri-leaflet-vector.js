/* esri-leaflet-vector - v2.0.1 - Fri Jan 22 2021 10:21:37 GMT+1300 (New Zealand Daylight Time)
 * Copyright (c) 2021 Environmental Systems Research Institute, Inc.
 * Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet"),require("mapbox-gl"),require("esri-leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet","mapbox-gl","esri-leaflet"],e):e((t.L=t.L||{},t.L.esri=t.L.esri||{},t.L.esri.Vector={}),t.L,t.mapboxgl,t.L.esri)}(this,function(t,e,i,a){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var o,n;function s(t,i){a.request(t,{},function(o,n){if(o)throw new Error("Unable to fetch vector tile style metadata");a.request(n.sources.esri.url,{},function(a,o){a||(!function(t,e,i){t.sources.esri.url&&-1===t.sources.esri.url.indexOf("http")&&(t.sources.esri.url=i.replace("/resources/styles/root.json",""));e.tiles&&"/"!==e.tiles[0].charAt(0)&&(e.tiles[0]="/"+e.tiles[0]);e.tileMap&&"/"!==e.tileMap.charAt(0)&&(e.tileMap="/"+e.tileMap);t.sources.esri={type:"vector",scheme:"xyz",tilejson:e.tilejson||"2.0.0",format:e.tileInfo&&e.tileInfo.format||"pbf",index:e.tileMap?t.sources.esri.url+e.tileMap:null,tiles:[t.sources.esri.url+e.tiles[0]],description:e.description,name:e.name,maxzoom:15},-1===t.glyphs.indexOf("http")&&(t.glyphs=i.replace("styles/root.json",t.glyphs.replace("../","")),t.sprite=i.replace("styles/root.json",t.sprite.replace("../","")))}(n,o,t),i._mapboxGL=e.mapboxGL({accessToken:"ezree",style:n}),i._ready=!0,i.fire("ready",{},!0))},i)},i)}o=void 0,n=function(t,e){t.MapboxGL=t.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(i){t.setOptions(this,i),i.accessToken&&(e.accessToken=i.accessToken),this._throttledUpdate=t.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(e){this._container||this._initContainer();var i=this.getPaneName();e.getPane(i).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),e.options.zoomAnimation&&t.DomEvent.on(e._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(e){this._map._proxy&&this._map.options.zoomAnimation&&t.DomEvent.off(this._map._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this);var i=this.getPaneName();e.getPane(i).removeChild(this._container),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMapboxMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+2*this.options.padding)},getBounds:function(){var e=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return t.latLngBounds(this._map.containerPointToLatLng(i.subtract(e)),this._map.containerPointToLatLng(i.add(e)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_initContainer:function(){var e=this._container=t.DomUtil.create("div","leaflet-gl-layer"),i=this.getSize(),a=this._map.getSize().multiplyBy(this.options.padding);e.style.width=i.x+"px",e.style.height=i.y+"px";var o=this._map.containerPointToLayerPoint([0,0]).subtract(a);t.DomUtil.setPosition(e,o)},_initGL:function(){var i=this._map.getCenter(),a=t.extend({},this.options,{container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new e.Map(a),this._glMap.transform.latRange=null,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var o=this._glMap._actualCanvas;t.DomUtil.addClass(o,"leaflet-image-layer"),t.DomUtil.addClass(o,"leaflet-zoom-animated"),this.options.interactive&&t.DomUtil.addClass(o,"leaflet-interactive"),this.options.className&&t.DomUtil.addClass(o,this.options.className)},_update:function(e){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var i=this.getSize(),a=this._container,o=this._glMap,n=this._map.getSize().multiplyBy(this.options.padding),s=this._map.containerPointToLayerPoint([0,0]).subtract(n);t.DomUtil.setPosition(a,s),this._transformGL(o),o.transform.width!==i.x||o.transform.height!==i.y?(a.style.width=i.x+"px",a.style.height=i.y+"px",null!==o._resize&&void 0!==o._resize?o._resize():o.resize()):null!==o._update&&void 0!==o._update?o._update():o.update()}},_transformGL:function(t){var i=this._map.getCenter(),a=t.transform;a.center=e.LngLat.convert([i.lng,i.lat]),a.zoom=this._map.getZoom()-1},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(e){var i=this._map.getZoomScale(e.zoom),a=this._map.getSize().multiplyBy(this.options.padding*i),o=this.getSize()._divideBy(2),n=this._map.project(e.center,e.zoom)._subtract(o)._add(this._map._getMapPanePos().add(a))._round(),s=this._map.project(this._map.getBounds().getNorthWest(),e.zoom)._subtract(n);t.DomUtil.setTransform(this._glMap._actualCanvas,s.subtract(this._offset),i)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var e=this._map.getZoomScale(this._map.getZoom());t.DomUtil.setTransform(this._glMap._actualCanvas,null,e),this._zooming=!1,this._update()},_transitionEnd:function(e){t.Util.requestAnimFrame(function(){var e=this._map.getZoom(),i=this._map.getCenter(),a=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());t.DomUtil.setTransform(this._glMap._actualCanvas,a,1),this._glMap.once("moveend",t.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:i,zoom:e-1})},this)},_resize:function(t){this._transitionEnd(t)}}),t.mapboxGL=function(e){return new t.MapboxGL(e)}},"function"==typeof define&&define.amd?define(["leaflet","mapbox-gl"],n):"object"==typeof t?module.exports=n(require("leaflet"),require("mapbox-gl")):o.returnExports=n(window.L,window.mapboxgl);var r=e.Layer.extend({statics:{URLPREFIX:"https://www.arcgis.com/sharing/rest/content/items/",URLSUFFIX:"/resources/styles/root.json",STYLES:{OpenStreetMap:"3e1a00aeae81496587988075fe529f71",Streets:"de26a3cf4cc9451298ea173c4b324736",StreetsRelief:"b266e6d17fc345b498345613930fbd76",Topographic:"7a6bf0e8cb5a418085e66c0485e74d19",StreetsNight:"93554006894c45a88136127535878fca",Newspaper:"dfb04de5f3144a80bc3f9f336228d24a",Navigation:"63c47b7177f946b49902c24129b87252",Nova:"75f4dfdff19e445395653121a95a85db",ColoredPencil:"4cf7e1fb9f254dcda9c8fbadb15cf0f8",Hybrid:"30d6b8271e1849cd9c3042060001f425",Gray:"291da5eab3a0412593b66d384379f89f",DarkGray:"5e9b3685f4c24d8781073dd928ebda50",HumanGeography:"2afe5b807fa74006be6363fd243ffb30",HumanGeographyDetail:"97fa1365da1e43eabb90d0364326bc2d",DarkHumanGeography:"d7397603e9274052808839b70812be50",DarkHumanGeographyDetail:"1ddbb25aa29c4811aaadd94de469856a",ChartedTerritory:"1c365daf37a744fbad748b67aa69dac8",MidCentury:"7675d44bb1e4428aa2c30a9b68f97822"}},initialize:function(t){if(t={key:t},this._basemap=t.key,"string"!=typeof t.key||!r.STYLES[t.key])throw new Error('L.esri.Vector.Basemap: Invalid parameter. Use one of "DarkGray", "Gray", "Hybrid", "Navigation", "Streets", "StreetsNight", "StreetsRelief", "Topographic"');s(r.URLPREFIX+r.STYLES[t.key]+r.URLSUFFIX,this)},onAdd:function(t){this._map=t,a.Util.setEsriAttribution(t),t.attributionControl&&("OpenStreetMap"===this._basemap?(t.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, map layer by Esri</span>')):(a.Util._getAttributionData("https://static.arcgis.com/attribution/World_Street_Map",t),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">USGS, NOAA</span>'))),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(t){if(t.off("moveend",a.Util._updateMapAttribution),t.removeLayer(this._mapboxGL),t.attributionControl){var e=document.getElementsByClassName("esri-dynamic-attribution")[0].outerHTML;t.attributionControl.removeAttribution(e)}},_asyncAdd:function(){var t=this._map;t.getContainer().style.background=this._mapboxGL.options.style.layers[0].paint["background-color"]||"#e1e3d0",t.on("moveend",a.Util._updateMapAttribution),this._mapboxGL.addTo(t,this)}});var p=e.Layer.extend({statics:{URLPREFIX:"https://www.arcgis.com/sharing/rest/content/items/"},initialize:function(t){if("string"!=typeof(t={id:t}).id)throw new Error("L.esri.Vector.Layer: Invalid parameter. Use the id of an ArcGIS Online vector tile item");var e=p.URLPREFIX+t.id;a.request(e,{},function(t,i){t||(i.url,s(e+"/resources/styles/root.json",this))},this)},onAdd:function(t){this._map=t,a.Util.setEsriAttribution(t),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(t){if(t.off("moveend",a.Util._updateMapAttribution),t.removeLayer(this._mapboxGL),t.attributionControl){var e=document.getElementsByClassName("esri-dynamic-attribution")[0].outerHTML;t.attributionControl.removeAttribution(e)}},_asyncAdd:function(){var t=this._map;t.attributionControl&&(this._customTileset?this._copyrightText&&t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">'+this._copyrightText+"</span>"):(a.Util._getAttributionData("https://static.arcgis.com/attribution/World_Street_Map",t),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">USGS, NOAA</span>'),t.on("moveend",a.Util._updateMapAttribution))),t.getContainer().style.background=this._mapboxGL.options.style.layers[0].paint["background-color"],this._mapboxGL.addTo(t,this)}});t.VERSION="2.0.1",t.Basemap=r,t.basemap=function(t){return new r(t)},t.Layer=p,t.layer=function(t){return new p(t)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=esri-leaflet-vector.js.map
